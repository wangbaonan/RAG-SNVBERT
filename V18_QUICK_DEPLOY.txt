====================================================================
V18 Maskå¯¹é½ç‰ˆæœ¬ - å¿«é€Ÿéƒ¨ç½²æŒ‡å—
====================================================================

çŠ¶æ€: âœ… ä»£ç å·²ä¿®æ”¹å®Œæˆ
æ—¥æœŸ: 2025-12-03

====================================================================
æ ¸å¿ƒæ”¹è¿›
====================================================================

é—®é¢˜: Queryå’ŒReferenceçš„maskä¸ä¸€è‡´ â†’ è¯­ä¹‰é¸¿æ²Ÿ
è§£å†³:
  - æ£€ç´¢æ—¶: Queryå’ŒReferenceéƒ½ç”¨ç›¸åŒmask (è¯­ä¹‰å¯¹é½)
  - ä½¿ç”¨æ—¶: è¿”å›å®Œæ•´embeddings (æä¾›å®Œæ•´ä¿¡æ¯)
  - å¢å¼º:   æ¯ä¸ªepochåˆ·æ–°mask (æ•°æ®å¢å¼º)

====================================================================
5æ­¥å¿«é€Ÿéƒ¨ç½² (åœ¨æœåŠ¡å™¨ä¸Š)
====================================================================

cd /path/to/VCF-Bert

# 1. Pullä»£ç 
git pull origin main

# 2. éªŒè¯æ–‡ä»¶
grep "ref_embeddings_complete" src/dataset/embedding_rag_dataset.py
# åº”è¯¥æ‰¾åˆ°åŒ¹é…

# 3. æ£€æŸ¥GPU
nvidia-smi
# ç¡®è®¤è‡³å°‘20GBç©ºé—²

# 4. è¿è¡Œ
bash run_v18_embedding_rag.sh

# 5. ç›‘æ§
tail -f logs/v18_embedding_rag/latest.log

====================================================================
å…³é”®ç›‘æ§æŒ‡æ ‡
====================================================================

åˆå§‹åŒ– (~18åˆ†é’Ÿ):
  âœ“ é¢„ç¼–ç å®Œæˆ!
  - Maskç‰ˆæœ¬å·: 0
  - å­˜å‚¨å¤§å°: 1486.4 MB (ä¸¤å¥—embeddings) â† æ³¨æ„ç¿»å€!

Epoch 1 (~1.5å°æ—¶):
  Train F1: 0.9201
  Val F1: 0.9505
  âœ“ Completeåˆ·æ–°å®Œæˆ!

Epoch 2 (~1.8å°æ—¶):
  â–£ åˆ·æ–°Mask Pattern (ç‰ˆæœ¬ 1, Seed=2) â† å…³é”®!
  âœ“ Maskåˆ·æ–°å®Œæˆ! æ–°ç‰ˆæœ¬: 1 â† Maskç‰ˆæœ¬é€’å¢!
  âœ“ ç´¢å¼•é‡å»ºå®Œæˆ! è€—æ—¶: 492s
  [æ­£å¸¸è®­ç»ƒ...]
  âœ“ Completeåˆ·æ–°å®Œæˆ!

æ­£å¸¸æ ‡å¿—:
  âœ… Maskç‰ˆæœ¬å·é€’å¢ (0â†’1â†’2â†’...)
  âœ… å­˜å‚¨å¤§å°: 1486.4 MB (ä¸¤å¥—)
  âœ… Train F1: 0.92-0.96 (ä¸ä¼šè™šé«˜åˆ°0.978)
  âœ… Val F1: 0.95-0.96 (ç¨³å®š)

å¼‚å¸¸æ ‡å¿—:
  âŒ å­˜å‚¨å¤§å°åªæœ‰743MB â†’ ä»£ç æœªæ›´æ–°
  âŒ Maskç‰ˆæœ¬å·ä¸é€’å¢ â†’ åˆ·æ–°æœªå‘ç”Ÿ
  âŒ Train F1=0.978 â†’ è¿‡æ‹Ÿåˆï¼Œmaskæœªåˆ·æ–°
  âŒ OOM â†’ batch sizeå¤ªå¤§

====================================================================
å¦‚æœå‡ºç°OOM
====================================================================

ç¼–è¾‘: run_v18_embedding_rag.sh
ä¿®æ”¹:
  --train_batch_size 8   # åŸæ¥16
  --val_batch_size 8     # åŸæ¥16

====================================================================
ç›‘æ§å‘½ä»¤
====================================================================

# å®æ—¶æ—¥å¿—
tail -f logs/v18_embedding_rag/latest.log

# GPU
watch -n 1 nvidia-smi

# æŒ‡æ ‡
watch -n 10 "tail -10 metrics/v18_embedding_rag/latest.csv"

# è¿›ç¨‹
ps aux | grep train_embedding_rag

====================================================================
æ•…éšœæ’æŸ¥
====================================================================

é—®é¢˜1: Pullåæ–‡ä»¶æœªæ›´æ–°
  grep "ref_embeddings_complete" src/dataset/embedding_rag_dataset.py
  # å¦‚æœæ‰¾ä¸åˆ° â†’ é‡æ–°pull: git pull --force origin main

é—®é¢˜2: AttributeError: 'ref_embeddings_complete'
  åŸå› : ä»£ç ä¸å®Œæ•´
  è§£å†³: git pull --force origin main

é—®é¢˜3: Maskç‰ˆæœ¬å·ä¸é€’å¢
  æ£€æŸ¥: grep "regenerate_masks" src/train_embedding_rag.py
  # å¦‚æœæ‰¾ä¸åˆ° â†’ ä»£ç æœªæ›´æ–°

é—®é¢˜4: å­˜å‚¨å¤§å°åªæœ‰743MB
  åŸå› : åªæœ‰ä¸€å¥—embeddingsï¼Œä»£ç æœªæ›´æ–°
  è§£å†³: é‡æ–°pull

====================================================================
é¢„æœŸæ€§èƒ½
====================================================================

æ—¶é—´:
  - åˆå§‹åŒ–: 18åˆ†é’Ÿ
  - Epoch 1: 1.5å°æ—¶
  - Epoch 2+: 1.8å°æ—¶
  - 20 epochs: ~32å°æ—¶

å†…å­˜:
  - Reference Embeddings: 1486 MB (ä¸¤å¥—)
  - GPUæ˜¾å­˜: 15-18GB/batch
  - æ¯”V17çœ ä½†æ¯”åŸV18å¤š

æ€§èƒ½:
  - Train F1: 0.94-0.96
  - Val F1: 0.95-0.96
  - Rare F1: 0.91-0.93
  - åº”è¯¥ç¨³å®šï¼Œä¸ä¼šå´©æºƒ

====================================================================
å¯¹æ¯”æ€»ç»“
====================================================================

| ç‰¹æ€§           | V17      | V18(åŸç‰ˆ) | V18(ä¿®å¤ç‰ˆ) |
|---------------|----------|-----------|------------|
| Maskå¯¹é½       | âŒ       | âŒ        | âœ… æ£€ç´¢æ—¶   |
| å®Œæ•´ä¿¡æ¯       | âŒ       | âŒ        | âœ… ä½¿ç”¨æ—¶   |
| Dynamic mask  | âŒ       | âŒ        | âœ… æ¯epoch  |
| é€Ÿåº¦          | 4.2h     | 1.3h      | 1.6h âš¡     |
| å†…å­˜          | 19GB     | 15GB      | 15GB ğŸ’¾     |
| æ­£ç¡®æ€§        | âš ï¸       | âš ï¸        | âœ…          |

====================================================================
å®Œæ•´æ–‡æ¡£
====================================================================

è¯¦ç»†æ–‡æ¡£: V18_MASK_ALIGNED_DEPLOYMENT.md
è®¾è®¡æ–‡æ¡£: MASK_REFRESH_DESIGN.md
é—®é¢˜åˆ†æ: MASK_ALIGNMENT_CRITICAL_ISSUE.md

====================================================================
ä¸€é”®å‘½ä»¤
====================================================================

cd /path/to/VCF-Bert && \
git pull origin main && \
bash run_v18_embedding_rag.sh

====================================================================
æˆåŠŸæ ‡å¿— (æ£€æŸ¥å‰2ä¸ªepoch)
====================================================================

1. âœ… åˆå§‹åŒ–æ˜¾ç¤º: "å­˜å‚¨å¤§å°: 1486.4 MB (ä¸¤å¥—embeddings)"
2. âœ… Epoch 1ç»“æŸ: "âœ“ Completeåˆ·æ–°å®Œæˆ!"
3. âœ… Epoch 2å¼€å§‹: "â–£ åˆ·æ–°Mask Pattern (ç‰ˆæœ¬ 1, Seed=2)"
4. âœ… Epoch 2æ˜¾ç¤º: "âœ“ Maskåˆ·æ–°å®Œæˆ! æ–°ç‰ˆæœ¬: 1"
5. âœ… Epoch 2æ˜¾ç¤º: "âœ“ ç´¢å¼•é‡å»ºå®Œæˆ!"
6. âœ… Val F1ç¨³å®šåœ¨0.95å·¦å³

å¦‚æœä»¥ä¸Šéƒ½æ»¡è¶³ â†’ è®­ç»ƒæ­£å¸¸ï¼Œå¯ä»¥æ”¾å¿ƒè®©å®ƒè·‘å®Œ20ä¸ªepoch!

====================================================================
